{% extends "base.html" %}
{% block content %}
<link rel="stylesheet" href="/static/styles/pages/studies.css">
<link rel="stylesheet" href="/static/styles/header.css">
<header id="header">
  <img src="{{base}}/static/img/p215-circle.svg" class="logo">
  <menu class="menu">
    <li class="mobileHidden">
      <a href="https://experiencethehope.com/teaching" target="_blank">
        Teachings
      </a>
    </li>
    <li class="mobileHidden">
      <a href="https://experiencethehope.com/equipping" target="_blank">
        Equipping
      </a>
    </li>
    <li class="mobileHidden">
      <a href="https://messaging.subsplash.com/25FXCW/auth" target="_blank">
        Messaging
      </a>
    </li>
    <li>
      <button class="blue mobileHidden" onclick="toggleModal('#newStudy')">
        + New Study
      </button>
    </li>
  </menu>

  <div class="buttons">
    <button class="profileButton" onclick="toggleModal('#profileNav')">
      {{user.nameShort}}
    </button>
  </div>
</header>

<dialog id="profileNav">
  <menu>
    <li class="mobileShow" style="padding-bottom: 5px;">
      <button class="blue" onclick="toggleModal('#newStudy')">
        + New Study
      </button>
    </li>
    <li>
      <a href="{{base}}/profile">
        Profile
      </a>
    </li>
    <li>
      <a href="https://forms.gle/koJrP31Vh9TfvPcq7" target="_blank">
        Give Feedback
      </a>
    </li>
    <li>
      <a href="{{base}}/signout">
        Sign Out
      </a>
    </li>
  </menu>
</dialog>

<div id="studiesScroll">
<div id="studiesContent">

  {% if deletedDocId %}
  <div class="undoBanner">
    <span>"{{ deletedName }}" was deleted.</span>
    <form method="post" action="{{base}}/study/{{deletedDocId}}/restore">
      <button type="submit" class="undoButton">Undo</button>
    </form>
  </div>
  {% endif %}

  {% if length(shares) > 0 %}
  <div id="allShares">
    <h1>Invites</h1>
    <div class="table3">
      <header>
        Group Study
      </header>
      <header>
        Template Name
      </header>
      <header>
      </header>
      {% for share in shares %}
        <div class="row share" id="share-{{share.token}}">
          <div>
            {{ share.groupStudyName }}
          </div>
          <div
            {% if share.studyTemplateId %}
            {% else %}
              class = "shareWith"
            {% endif %}
          >
            {% if share.studyTemplateId %}
              {{share.studyTemplateName }}
            {% else %}
              Free Hand
            {% endif %}
          </div>
          <div class="options">
            <form
               hx-post="/group_study/share/{{share.token}}"
            >
              <p-select name="document">
                <option value="new">New Document</option>
                {% for study in studies %}
                  {% if study.groupStudyName %}
                  {% else %}
                    <option value="{{study.docId}}">{{study.name}}</option>
                  {% endif %}
                {% endfor %}
              </p-select>
              <button class="blue accept" type="submit">Accept</button>
              <button
                class="red reject"
                hx-delete="/group_study/share/{{share.token}}"
                hx-target="#share-{{share.token}}"
                hx-swap="delete"
              >
                Reject
              </button>
            </form>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>
  {% endif %}

  <div class="tabBar">
    <button class="tab active" onclick="switchTab('myStudies', this)">My Studies</button>
    <button class="tab" onclick="switchTab('deletedStudies', this)">
      Trash
    </button>
  </div>

  <div id="myStudies" class="tabContent">
    <div class="table3">
      <header>
        Study Title
      </header>
      <header>
        Group Study
      </header>
      <header>
        Last Opened By Me
      </header>
      {% for study in studies %}
        <a href="{{base}}/study/{{study.docId}}">
          <div style="view-transition-name: study-{{study.docId}}">
            {{study.name}}
          </div>
          <div
            {% if study.groupStudyName %}
            {% else %}
              class="shareWith"
            {% endif %}
          >
            {% if study.groupStudyName %}
              {{study.groupStudyName}}
            {% else %}
              Independent
            {% endif %}
          </div>
          <div>
            {{dateformat(study.updated, "%B %e, %Y")}}
          </div>
        </a>
      {% endfor %}
    </div>
  </div>

  <div id="deletedStudies" class="tabContent" style="display: none;">
    {% if length(deletedStudies) == 0 %}
      <p class="emptyTrash">You don't have any deleted studies. If you delete any, they will appear here.</p>
    {% else %}
      <div class="table3">
        <header>
          Study Title
        </header>
        <header>
          Group Study
        </header>
        <header>
        </header>
        {% for study in deletedStudies %}
          <div class="row deletedRow">
            <div>
              {{study.name}}
            </div>
            <div
              {% if study.groupStudyName %}
              {% else %}
                class="shareWith"
              {% endif %}
            >
              {% if study.groupStudyName %}
                {{study.groupStudyName}}
              {% else %}
                Independent
              {% endif %}
            </div>
            <div>
              <form method="post" action="{{base}}/study/{{study.docId}}/restore">
                <button type="submit" class="restoreButton">Restore</button>
              </form>
            </div>
          </div>
        {% endfor %}
      </div>
    {% endif %}
  </div>

</div>

{% include "footer.html" %}
</div>

<dialog id="newStudy">
  <h3>Create New Study</h3>
  <button type="button" class="closeModalIcon" aria-label="Close" onclick="toggleModal('#newStudy')">
    <img alt="" src="{{base}}/static/img/x.svg">
  </button>
  <form hx-post="{{base}}/study">
    <label for="studyTitle">Title</label>
    <input type="text" required name="studyTitle" placeholder="New Title...">
    <p class="fieldDescription">
      Ex: "<em>Romans January 2024 Study</em>"
      or "<em>Wednesday Night Colossians Study</em>"
    </p>
    <button type="submit" class="blue">
      Create
    </button>
  </form>
</dialog>

<script>
function switchTab(tabId, btn) {
  document.querySelectorAll('.tabContent').forEach(el => el.style.display = 'none');
  document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
  document.getElementById(tabId).style.display = 'block';
  btn.classList.add('active');
}
</script>

{% endblock %}
